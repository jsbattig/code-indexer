<h2>Golden Repositories</h2>

<table class="golden-repos-table" role="grid">
    <thead>
        <tr>
            <th>Name</th>
            <th>Global Alias</th>
            <th>Version</th>
            <th>Indexes</th>
            <th>Path/URL</th>
            <th style="min-width: 100px;">Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if repos %}
        {% for repo in repos %}
        <tr>
            <td>{{ repo.alias }}</td>
            <td>
                {% if repo.global_alias %}
                <code class="global-alias">{{ repo.global_alias }}</code>
                {% else %}
                <span class="no-global">-</span>
                {% endif %}
            </td>
            <td>
                {% if repo.version %}
                <code class="version-tag">{{ repo.version }}</code>
                {% else %}
                <span class="no-version">-</span>
                {% endif %}
            </td>
            <td class="indexes-cell" style="white-space: nowrap;">
                {% if repo.has_semantic %}<span class="index-badge semantic" title="Semantic search available">Semantic</span>{% endif %}
                {% if repo.has_fts %}<span class="index-badge fts" title="Full-text search available">FTS</span>{% endif %}
                {% if repo.has_temporal %}<span class="index-badge temporal" title="Git history search available">Temporal</span>{% endif %}
                {% if not repo.has_semantic and not repo.has_fts and not repo.has_temporal %}<span class="no-indexes">None</span>{% endif %}
            </td>
            <td class="repo-url" title="{{ repo.repo_url }}">{{ repo.repo_url | truncate(40) }}</td>
            <td class="status-cell" style="white-space: nowrap;">
                {% if repo.status == 'indexing' %}
                <span class="status-indicator status-indexing" title="Indexing in progress">
                    <span class="spinner"></span> Indexing
                </span>
                {% elif repo.status == 'error' %}
                <span class="status-indicator status-error" title="Error: {{ repo.error_message }}">
                    Error
                </span>
                {% else %}
                <span class="status-indicator status-ready">
                    Ready
                </span>
                {% endif %}
            </td>
            <td class="actions-cell">
                <button class="outline small" onclick="toggleDetails('{{ repo.alias }}')" title="View details">Details</button>
                <button class="small" onclick="showActivateModal('{{ repo.alias }}')" {% if repo.status == 'indexing' %}disabled title="Currently indexing"{% else %}title="Activate for a user"{% endif %}>Activate</button>
                <button class="outline small" onclick="confirmRefresh('{{ repo.alias }}')" {% if repo.status == 'indexing' %}disabled title="Currently indexing"{% else %}title="Re-index repository"{% endif %}>Refresh</button>
                <button class="outline small danger" onclick="confirmDelete('{{ repo.alias }}')" title="Delete repository">Delete</button>
            </td>
        </tr>

        <!-- Details Row (hidden by default) -->
        <tr id="details-{{ repo.alias }}" class="details-row" style="display: none;">
            <td colspan="7">
                <article class="repo-details">
                    <div class="details-grid">
                        <div class="detail-item">
                            <label>Name:</label>
                            <span>{{ repo.alias }}</span>
                        </div>
                        <div class="detail-item">
                            <label>Global Alias:</label>
                            <span>{% if repo.global_alias %}<code>{{ repo.global_alias }}</code> (queryable without activation){% else %}Not globally activated{% endif %}</span>
                        </div>
                        <div class="detail-item">
                            <label>Version:</label>
                            <span>{% if repo.version %}<code>{{ repo.version }}</code>{% else %}Not versioned{% endif %}</span>
                        </div>
                        <div class="detail-item">
                            <label>Last Refresh:</label>
                            <span>{{ repo.last_refresh or 'Never' }}</span>
                        </div>
                        <div class="detail-item">
                            <label>Path/URL:</label>
                            <span>{{ repo.repo_url }}</span>
                        </div>
                        <div class="detail-item">
                            <label>Branch:</label>
                            <span>{{ repo.default_branch or 'main' }}</span>
                        </div>
                        <div class="detail-item">
                            <label>Available Indexes:</label>
                            <span>
                                {% if repo.has_semantic %}Semantic{% endif %}
                                {% if repo.has_semantic and (repo.has_fts or repo.has_temporal) %}, {% endif %}
                                {% if repo.has_fts %}FTS{% endif %}
                                {% if repo.has_fts and repo.has_temporal %}, {% endif %}
                                {% if repo.has_temporal %}Temporal{% endif %}
                                {% if not repo.has_semantic and not repo.has_fts and not repo.has_temporal %}None{% endif %}
                            </span>
                        </div>
                        <div class="detail-item">
                            <label>Status:</label>
                            <span>{{ repo.status or 'ready' }}</span>
                        </div>
                        <div class="detail-item">
                            <label>Created:</label>
                            <span>{{ repo.created_at or 'N/A' }}</span>
                        </div>
                        {% if repo.file_count is defined %}
                        <div class="detail-item">
                            <label>Files Indexed:</label>
                            <span>{{ repo.file_count }}</span>
                        </div>
                        {% endif %}
                        {% if repo.chunk_count is defined %}
                        <div class="detail-item">
                            <label>Chunks Indexed:</label>
                            <span>{{ repo.chunk_count }}</span>
                        </div>
                        {% endif %}
                        {% if repo.error_message %}
                        <div class="detail-item error-details">
                            <label>Error:</label>
                            <span class="error-text">{{ repo.error_message }}</span>
                        </div>
                        {% endif %}
                    </div>
                </article>
            </td>
        </tr>

        <!-- Delete Form (hidden) -->
        <form id="delete-form-{{ repo.alias }}" method="post" action="/admin/golden-repos/{{ repo.alias }}/delete" style="display: none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        </form>

        <!-- Refresh Form (hidden) -->
        <form id="refresh-form-{{ repo.alias }}" method="post" action="/admin/golden-repos/{{ repo.alias }}/refresh" style="display: none;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        </form>
        {% endfor %}
        {% else %}
        <tr>
            <td colspan="7" class="no-data">No golden repositories configured. Click "Add Repository" to add one.</td>
        </tr>
        {% endif %}
    </tbody>
</table>

<style>
.index-badge {
    display: inline-block;
    padding: 2px 6px;
    margin: 1px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}
.index-badge.semantic {
    background-color: #e3f2fd;
    color: #1565c0;
}
.index-badge.fts {
    background-color: #f3e5f5;
    color: #7b1fa2;
}
.index-badge.temporal {
    background-color: #fff3e0;
    color: #e65100;
}
.no-indexes {
    color: #999;
    font-style: italic;
}
.version-tag {
    font-size: 0.8rem;
    background-color: #f5f5f5;
    padding: 2px 6px;
    border-radius: 4px;
}
.no-version {
    color: #999;
}
.global-alias {
    background-color: #e8f5e9;
    color: #2e7d32;
    padding: 2px 6px;
    border-radius: 4px;
}
.no-global {
    color: #999;
}
</style>
