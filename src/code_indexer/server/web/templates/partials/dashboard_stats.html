<!-- Job Statistics Section -->
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Jobs</h2>
    <div>
        <label for="time-filter" style="margin-right: 0.5rem;">Time Range:</label>
        <select id="time-filter" onchange="updateJobStats()" style="padding: 0.25rem 0.5rem;">
            <option value="24h" {{ 'selected' if time_filter == '24h' else '' }}>Last 24 Hours</option>
            <option value="7d" {{ 'selected' if time_filter == '7d' else '' }}>Last 7 Days</option>
            <option value="30d" {{ 'selected' if time_filter == '30d' else '' }}>Last 30 Days</option>
        </select>
    </div>
</div>

<div class="stats-grid">
    <article class="stat-card">
        <header>
            <h3>Running</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/jobs?status=running">{{ job_counts.running if job_counts else 0 }}</a>
        </div>
        <footer>
            <small>Currently executing</small>
        </footer>
    </article>

    <article class="stat-card">
        <header>
            <h3>Queued</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/jobs?status=pending">{{ job_counts.queued if job_counts else 0 }}</a>
        </div>
        <footer>
            <small>Waiting to run</small>
        </footer>
    </article>

    <article class="stat-card stat-success">
        <header>
            <h3>Completed ({{ time_filter or '24h' }})</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/jobs?status=completed">{{ job_counts.completed_24h if job_counts else 0 }}</a>
        </div>
        <footer>
            <small>Last {{ time_filter or '24h' }}</small>
        </footer>
    </article>

    <article class="stat-card stat-danger">
        <header>
            <h3>Failed ({{ time_filter or '24h' }})</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/jobs?status=failed">{{ job_counts.failed_24h if job_counts else 0 }}</a>
        </div>
        <footer>
            <small>Last {{ time_filter or '24h' }}</small>
        </footer>
    </article>
</div>

<!-- Repository Statistics Section -->
<h2>Repositories</h2>

<div class="stats-grid">
    <article class="stat-card">
        <header>
            <h3>Golden Repos</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/golden-repos">{{ repo_counts.golden if repo_counts else 0 }}</a>
        </div>
        <footer>
            <small>Source repositories</small>
        </footer>
    </article>

    <article class="stat-card">
        <header>
            <h3>Activated Repos</h3>
        </header>
        <div class="stat-value">
            <a href="/admin/repos">{{ repo_counts.activated if repo_counts else 0 }}</a>
        </div>
        <footer>
            <small>User activated</small>
        </footer>
    </article>
</div>

<!-- Recent Activity Section -->
<div style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Recent Activity</h2>
    <div>
        <label for="recent-filter" style="margin-right: 0.5rem;">Time Range:</label>
        <select id="recent-filter" onchange="updateRecentActivity()" style="padding: 0.25rem 0.5rem;">
            <option value="24h" {{ 'selected' if recent_filter == '24h' else '' }}>Last 24 Hours</option>
            <option value="7d" {{ 'selected' if recent_filter == '7d' else '' }}>Last 7 Days</option>
            <option value="30d" {{ 'selected' if recent_filter == '30d' else '' }}>Last 30 Days</option>
        </select>
    </div>
</div>

<div class="recent-activity">
    {% if recent_jobs and recent_jobs|length > 0 %}
    <table role="grid">
        <thead>
            <tr>
                <th>Repository</th>
                <th>Job Type</th>
                <th>Completed</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for job in recent_jobs %}
            <tr>
                <td>
                    <a href="/admin/jobs?job_id={{ job.job_id }}">{{ job.repo_name }}</a>
                </td>
                <td>{{ job.job_type }}</td>
                <td>{{ job.completion_time[:19] if job.completion_time else 'N/A' }}</td>
                <td>
                    <span class="job-status status-{{ job.status }}">{{ job.status | capitalize }}</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p class="no-activity">No recent activity to display.</p>
    {% endif %}
</div>

<script>
function updateJobStats() {
    const timeFilter = document.getElementById('time-filter').value;
    const recentFilter = document.getElementById('recent-filter').value;
    htmx.ajax('GET', `/admin/partials/dashboard-stats?time_filter=${timeFilter}&recent_filter=${recentFilter}`, {
        target: '#stats-section',
        swap: 'innerHTML'
    });
}

function updateRecentActivity() {
    const timeFilter = document.getElementById('time-filter').value;
    const recentFilter = document.getElementById('recent-filter').value;
    htmx.ajax('GET', `/admin/partials/dashboard-stats?time_filter=${timeFilter}&recent_filter=${recentFilter}`, {
        target: '#stats-section',
        swap: 'innerHTML'
    });
}
</script>
