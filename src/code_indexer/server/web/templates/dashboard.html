{% extends "base.html" %}

{% block title %}Dashboard - CIDX Admin{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Dashboard</h1>
    <div class="dashboard-actions">
        <button
            id="refresh-btn"
            class="outline"
            hx-get="/admin/partials/dashboard-health"
            hx-target="#health-section"
            hx-swap="innerHTML"
            onclick="refreshAll()"
        >
            Refresh
        </button>
    </div>
</div>

<p>Welcome, <strong>{{ username }}</strong>!</p>

<!-- System Health Section -->
<section id="health-section" class="dashboard-section">
    {% include "partials/dashboard_health.html" %}
</section>

<!-- Statistics Section -->
<section id="stats-section" class="dashboard-section">
    {% include "partials/dashboard_stats.html" %}
</section>

<script>
let autoRefreshInterval = null;

function refreshAll() {
    // Trigger htmx refresh for both sections
    htmx.ajax('GET', '/admin/partials/dashboard-health', {target: '#health-section', swap: 'innerHTML'});
    htmx.ajax('GET', '/admin/partials/dashboard-stats', {target: '#stats-section', swap: 'innerHTML'});
}

// Start auto-refresh on page load (every 5 seconds)
document.addEventListener('DOMContentLoaded', function() {
    autoRefreshInterval = setInterval(refreshAll, 5000);
});

// Cleanup on page unload
window.addEventListener('beforeunload', function() {
    if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
    }
});
</script>
{% endblock %}
